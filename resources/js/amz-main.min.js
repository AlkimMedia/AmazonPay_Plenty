if("undefined"!=typeof $&&void 0===amz$)var amz$=$;var PlentyMarketsAmazonPay={isFirstAddressCall:!0,isInitialized:!1,isAddressInitialized:!1,isCompletelyInitialized:!1,getShippingList:function(){amz$.get("/amazon-ajax-handle",{action:"getShippingList"},function(n){-1!=n.indexOf("alert-warning")?amz$(".amz-checkout-order-button-wr").hide():amz$(".amz-checkout-order-button-wr").show(),amz$("#shippingOptionsListWr").html(n)})},getOrderDetails:function(){amz$.get("/amazon-ajax-handle",{action:"getOrderDetails"},function(n){amz$("#orderDetailsWr").html(n)})},logout:function(){"undefined"!=typeof amazon&&(amazon.Login.logout(),PlentyMarketsAmazonPay.logoutInterval&&clearInterval(PlentyMarketsAmazonPay.logoutInterval)),document.cookie="amazon_Login_accessToken=; expires=Thu, 01 Jan 1970 00:00:00 GMT"},getURLParameter:function(n,e){return decodeURIComponent((new RegExp("[?|&|#]"+n+"=([^&]+?)(&|#|;|$)").exec(e)||[,""])[1].replace(/\+/g,"%20"))||null},initialize:function(){if(void 0!==amz$){var n,e=amz$(".amzPayButton");if(e.length){var a=0;e.each(function(){var e=amz$(this),o=e.hasClass("articleCheckout"),t="amzPayButton_"+a++;e.attr("id",t),OffAmazonPayments.Button(t,amazonLoginAndPay.config.merchantId,{type:"PwA",color:amazonLoginAndPay.config.payButtonColor,size:amazonLoginAndPay.config.payButtonSize,language:"de-DE",authorization:function(){e.addClass("amz-loading").find("img").remove();var a=function(){var e={scope:"profile postal_code payments:widget payments:shipping_address payments:billing_address",popup:amazonLoginAndPay.config.popup};document.cookie="amzLoginType=Pay;path=/",n=amazonLoginAndPay.config.popup&&o?amazon.Login.authorize(e):amazon.Login.authorize(e,"/amazon-login-processing/")};o&&!amazonLoginAndPay.config.popup?PlentyMarketsAmazonPay.buyProduct(a):a()},onSignIn:function(e){amazonLoginAndPay.config.popup&&o&&PlentyMarketsAmazonPay.buyProduct(function(){location.href="/amazon-login-processing/?access_token="+n.access_token})},onError:function(n){console.error(n.getErrorMessage(),n.getErrorCode())}}),e.find("img").show()})}var o=amz$(".amzLoginButton");if(o.length){a=0;o.each(function(){var e=amz$(this),o="amzLoginButton_"+a++;e.attr("id",o),OffAmazonPayments.Button(o,amazonLoginAndPay.config.merchantId,{type:"LwA",color:amazonLoginAndPay.config.loginButtonColor,size:amazonLoginAndPay.config.loginButtonSize,language:"de-DE",authorization:function(){loginOptions={scope:"profile postal_code payments:widget payments:shipping_address payments:billing_address",popup:amazonLoginAndPay.config.popup},-1!==location.href.indexOf("%2Fcheckout")||-1!==location.href.indexOf("/checkout")?document.cookie="amzLoginType=Pay;path=/":document.cookie="amzLoginType=Login;path=/",n=amazon.Login.authorize(loginOptions,"/amazon-login-processing/")},onError:function(n){console.error(n.getErrorMessage(),n.getErrorCode())}}),e.find("img").show()})}if(amz$("#addressBookWidgetDiv").length?new OffAmazonPayments.Widgets.AddressBook({sellerId:amazonLoginAndPay.config.merchantId,scope:"profile postal_code payments:widget payments:shipping_address payments:billing_address",onOrderReferenceCreate:function(n){n=n.getAmazonOrderReferenceId(),0==PlentyMarketsAmazonPay.isInitialized&&amz$.get("/amazon-ajax-handle",{action:"setOrderReference",orderReference:n},function(){PlentyMarketsAmazonPay.isInitialized=!0,PlentyMarketsAmazonPay.isAddressInitialized&&(PlentyMarketsAmazonPay.getShippingList(),PlentyMarketsAmazonPay.getOrderDetails(),setTimeout(PlentyMarketsAmazonPay.getShippingList,2e3))})},onAddressSelect:function(n){PlentyMarketsAmazonPay.isAddressInitialized=!0,PlentyMarketsAmazonPay.isInitialized&&(PlentyMarketsAmazonPay.getShippingList(),PlentyMarketsAmazonPay.getOrderDetails())},design:{designMode:"responsive"},onReady:function(n){},onError:function(n){console.error(n.getErrorMessage(),n.getErrorCode())}}).bind("addressBookWidgetDiv"):amz$("#walletWidgetDiv").length&&PlentyMarketsAmazonPay.getOrderDetails(),amz$("#walletWidgetDiv").length){var t="EUR";amz$("#currency-input").length&&(t=amz$("#currency-input").val()),amazonLoginAndPay.widgets.walletWidget=new OffAmazonPayments.Widgets.Wallet({sellerId:amazonLoginAndPay.config.merchantId,presentmentCurrency:t,design:{designMode:"responsive"},onPaymentSelect:function(n){},onError:function(n){console.error(n.getErrorMessage(),n.getErrorCode())}}).bind("walletWidgetDiv")}}else setTimeout(PlentyMarketsAmazonPay.initialize,100)},cron:function(){setInterval(function(){void 0!==amz$&&(amz$(".amzPayButton:not([id])").length&&PlentyMarketsAmazonPay.initialize())},500)},getCookieValue:function(n){var e=document.cookie.match("(^|;)\\s*"+n+"\\s*=\\s*([^;]+)");return e?e.pop():""},buyProduct:function(n){if(window.ceresStore.state.item.variation.documents[0]){var e={variationId:window.ceresStore.state.item.variation.documents[0].data.variation.id,quantity:amz$(".articleCheckout").parent().parent().find('input[type="text"], input[type="number"]').first().val()};amz$.post("/rest/io/basket/items/",e,function(){n()})}else n()}};if(window.onAmazonLoginReady=function(){amazon.Login.setClientId(amazonLoginAndPay.config.clientId);var n=amz$('[name="amazon-pay-action"]');if(n.length)var e=n.val();e&&"logout"==e&&(PlentyMarketsAmazonPay.logout(),PlentyMarketsAmazonPay.logoutInterval=setInterval(PlentyMarketsAmazonPay.logout,500)),amazon.Login.setUseCookie(!0),amazon.Login.setRegion("EU"),amazonLoginAndPay.config.sandbox&&amazon.Login.setSandboxMode(!(!amazonLoginAndPay.config.sandbox||"true"!=amazonLoginAndPay.config.sandbox))},window.onAmazonPaymentsReady=function(){PlentyMarketsAmazonPay.initialize(),PlentyMarketsAmazonPay.cron()},void 0!==amz$&&amz$.fn.on){if(-1!==location.href.indexOf("amazon-login-processing/?access_token="))var accessToken=PlentyMarketsAmazonPay.getURLParameter("access_token",location.href);else accessToken=PlentyMarketsAmazonPay.getURLParameter("access_token",location.hash);"string"==typeof accessToken&&accessToken.match(/^Atza/)&&(amz$.get("/amazon-ajax-handle",{action:"setAccessToken",access_token:accessToken,do_login:"Login"===PlentyMarketsAmazonPay.getCookieValue("amzLoginType")?1:0},function(n){document.cookie="amzLoginType=Pay;path=/";var e=JSON.parse(n.trim());e.redirect&&(location.href=e.redirect)}),document.cookie="amazon_Login_accessToken="+accessToken+";secure;path=/"),amz$(document).on("change",'#shippingOptionsListWr [name="ShippingProfileID"]',function(){if(amz$(this).is(":checked")){var n=amz$(this).val();amz$.get("/amazon-ajax-handle",{action:"setShippingProfileId",id:n},function(n){amz$("#orderDetailsWr").html(n)})}}),amz$(function(){amz$(".amz-checkout-order-button-wr a").bind("click",function(n){if(amz$("#gtc-accept").length&&!amz$("#gtc-accept").is(":checked"))return n.preventDefault(),void alert(amz$("#gtc-accept").data("error"));var e=amz$(this);e.css({opacity:.5,cursor:"default"}),e.bind("click",function(n){n.preventDefault()})})})}